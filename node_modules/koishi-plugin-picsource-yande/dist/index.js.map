{"version":3,"sources":["webpack://koishi-plugin-picsource-yande/./src/config.ts","webpack://koishi-plugin-picsource-yande/./src/index.ts","webpack://koishi-plugin-picsource-yande/external commonjs \"koishi\"","webpack://koishi-plugin-picsource-yande/external commonjs \"koishi-plugin-pics\"","webpack://koishi-plugin-picsource-yande/external commonjs \"koishi-thirdeye\"","webpack://koishi-plugin-picsource-yande/webpack/bootstrap","webpack://koishi-plugin-picsource-yande/webpack/startup"],"names":["PicSourceYandePluginConfig","PicSourceYande","currentPage","picTags","page","data","matchingData","d","t","pic","module","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","__webpack_exports__"],"mappings":"yrBACA,eAGO,IAAMA,EAAN,OAAiC,C,EAAjC,8BACL,I,EAAC,gBAAa,CACZ,YACE,0JACF,QAAS,6BACT,KAAM,K,CACP,E,wDAGD,I,EAAC,gBAAa,CAAE,YAAa,iCAAS,QAAS,GAAI,CAAC,E,yDAGpD,I,EAAC,gBAAa,CAAE,YAAa,uEAAsB,QAAS,EAAK,CAAC,E,4DAZvDA,EAA0B,I,EADtC,kBAAc,C,EACFA,CAA0B,EAA1B,6BAAAA,C,21BCHb,eACA,SACA,SACA,SAEA,YAGe,IAAMC,EAAN,gB,EAA6B,mBAC1C,4BAA0B,CAC1B,CAFa,c,oBAGL,UAAO,CA0CjB,CAzCU,UAAW,CACjB,MAAMC,EAAc,KAAK,KACzB,OAAI,KAAK,MAAQ,KAAK,OAAO,UAC3B,KAAK,KAAO,EAEZ,EAAE,KAAK,KAEFA,CACT,CAEA,MAAM,UAAUC,EAAmB,CACjC,MAAMC,EAAO,KAAK,SAAS,EACrBC,EAAO,MAAM,KAAK,KAAK,IAAe,KAAK,OAAO,SAAU,CAChE,OAAQ,CACN,KAAMF,EAAQ,OAASA,EAAQ,KAAK,GAAG,EAAI,OAC3C,MAAO,IACP,KAAMC,C,EAET,EACD,GAAI,CAAC,MAAM,QAAQC,CAAI,EACrB,OAEF,GAAIA,EAAK,SAAW,EAClB,OAAID,IAAS,EACX,QAEF,KAAK,KAAO,EACL,KAAK,UAAUD,CAAO,GAE/B,MAAMG,EAAeH,EAAQ,OACzBE,EAAK,OAAQE,GAAMA,EAAE,KAAK,MAAM,GAAG,EAAE,KAAMC,GAAML,EAAQ,SAASK,CAAC,CAAC,CAAC,EACrEH,EACJ,GAAI,CAACC,EAAa,OAChB,OAEF,MAAMG,EAAM,SAAO,KAAKH,CAAY,EACpC,MAAO,CACL,IAAK,KAAK,OAAO,YAAcG,EAAI,SAAWA,EAAI,WAClD,YAAa,IAAIA,EAAI,MAAMA,EAAI,WAAWA,EAAI,Q,CAElD,C,EA5Ca,kBAAMR,EAAc,I,EADlC,gBAAY,C,EACQA,CAAc,E,UAAdA,C,UCTrBS,EAAO,QAAU,QAAQ,QAAQ,C,UCAjCA,EAAO,QAAU,QAAQ,oBAAoB,C,UCA7CA,EAAO,QAAU,QAAQ,iBAAiB,C,GCCtCC,EAA2B,CAAC,EAGhC,SAASC,EAAoBC,EAAU,CAEtC,IAAIC,EAAeH,EAAyBE,GAC5C,GAAIC,IAAiB,OACpB,OAAOA,EAAa,QAGrB,IAAIJ,EAASC,EAAyBE,GAAY,CAGjD,QAAS,CAAC,CACX,EAGA,OAAAE,EAAoBF,GAAU,KAAKH,EAAO,QAASA,EAAQA,EAAO,QAASE,CAAmB,EAGvFF,EAAO,OACf,CAlBS,EAAAE,EAAA,uBCDT,IAAII,EAAsBJ,EAAoB,GAAG,E","file":"index.js","sourcesContent":["// import 'source-map-support/register';\nimport { DefineSchema, RegisterSchema } from 'koishi-thirdeye';\n\n@RegisterSchema()\nexport class PicSourceYandePluginConfig {\n  @DefineSchema({\n    description:\n      '网站 post.json 的地址。如果使用 Konachan 则可以使用 `https://konachan.com/post.json` 。',\n    default: 'https://yande.re/post.json',\n    role: 'url',\n  })\n  endpoint: string;\n\n  @DefineSchema({ description: '页数上限。', default: 200 })\n  pageLimit: number;\n\n  @DefineSchema({ description: '使用原始图而不是 sample 图。', default: true })\n  useOriginal: boolean;\n}\n","// import 'source-map-support/register';\nimport { PicSourceYandePluginConfig } from './config';\nimport { DefinePlugin, Inject, ParentPlugin } from 'koishi-thirdeye';\nimport { PicSourcePlugin } from 'koishi-plugin-pics';\nimport { Random, Quester } from 'koishi';\nimport { PicInfo } from './def';\nexport * from './config';\n\n@DefinePlugin()\nexport default class PicSourceYande extends PicSourcePlugin(\n  PicSourceYandePluginConfig,\n) {\n  private page = 1;\n  private nextPage() {\n    const currentPage = this.page;\n    if (this.page >= this.config.pageLimit) {\n      this.page = 1;\n    } else {\n      ++this.page;\n    }\n    return currentPage;\n  }\n\n  async randomPic(picTags: string[]) {\n    const page = this.nextPage();\n    const data = await this.http.get<PicInfo[]>(this.config.endpoint, {\n      params: {\n        tags: picTags.length ? picTags.join('+') : undefined,\n        limit: 1000,\n        page: page,\n      },\n    });\n    if (!Array.isArray(data)) {\n      return;\n    }\n    if (data.length === 0) {\n      if (page === 1) {\n        return;\n      }\n      this.page = 1;\n      return this.randomPic(picTags);\n    }\n    const matchingData = picTags.length\n      ? data.filter((d) => d.tags.split(' ').some((t) => picTags.includes(t)))\n      : data;\n    if (!matchingData.length) {\n      return;\n    }\n    const pic = Random.pick(matchingData);\n    return {\n      url: this.config.useOriginal ? pic.file_url : pic.sample_url,\n      description: `#${pic.id} ${pic.tags} by ${pic.author}`,\n    };\n  }\n}\n","module.exports = require(\"koishi\");","module.exports = require(\"koishi-plugin-pics\");","module.exports = require(\"koishi-thirdeye\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(607);\n"],"sourceRoot":""}
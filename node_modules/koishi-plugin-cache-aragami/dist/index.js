var U=Object.defineProperty;var L=(P,v)=>U(P,"name",{value:v,configurable:!0});(()=>{"use strict";var P={913:function(d,i,c){var p=this&&this.__decorate||function(m,n,h,_){var l=arguments.length,e=l<3?n:_===null?_=Object.getOwnPropertyDescriptor(n,h):_,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")e=Reflect.decorate(m,n,h,_);else for(var t=m.length-1;t>=0;t--)(a=m[t])&&(e=(l<3?a(e):l>3?a(n,h,e):a(n,h))||e);return l>3&&e&&Object.defineProperty(n,h,e),e},k=this&&this.__metadata||function(m,n){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(m,n)};Object.defineProperty(i,"__esModule",{value:!0}),i.AragamiConfig=i.AragamiRedisConfig=void 0;const f=c(856);let g=L(class{},"AragamiRedisConfig");p([(0,f.SchemaProperty)({description:"Redis URI. "}),k("design:type",String)],g.prototype,"uri",void 0),g=p([(0,f.RegisterSchema)()],g),i.AragamiRedisConfig=g;let u=L(class{constructor(n){}getConfig(){const n={...this};return Object.getOwnPropertyNames(n.redis||{}).length||delete n.redis,n}},"AragamiConfig");p([(0,f.SchemaProperty)({description:"Redis \u914D\u7F6E\u3002"}),k("design:type",g)],u.prototype,"redis",void 0),u=p([(0,f.RegisterSchema)(),k("design:paramtypes",[Object])],u),i.AragamiConfig=u},607:function(d,i,c){var p=this&&this.__createBinding||(Object.create?function(e,a,t,r){r===void 0&&(r=t);var o=Object.getOwnPropertyDescriptor(a,t);(!o||("get"in o?!a.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return a[t]}}),Object.defineProperty(e,r,o)}:function(e,a,t,r){r===void 0&&(r=t),e[r]=a[t]}),k=this&&this.__decorate||function(e,a,t,r){var o=arguments.length,s=o<3?a:r===null?r=Object.getOwnPropertyDescriptor(a,t):r,C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,a,t,r);else for(var y=e.length-1;y>=0;y--)(C=e[y])&&(s=(o<3?C(s):o>3?C(a,t,s):C(a,t))||s);return o>3&&s&&Object.defineProperty(a,t,s),s},f=this&&this.__exportStar||function(e,a){for(var t in e)t!=="default"&&!Object.prototype.hasOwnProperty.call(a,t)&&p(a,e,t)},g=this&&this.__metadata||function(e,a){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,a)},u;Object.defineProperty(i,"__esModule",{value:!0}),i.PutLockingGuild=i.PutLockingChannel=i.PutLockingUser=i.CommandGuildLock=i.CommandChannelLock=i.CommandUserLock=i.UseLock=i.UseCache=void 0;const m=c(913),n=c(856),h=c(126),_=c(896);f(c(913),i),f(c(896),i);let l=L(class extends _.Aragami{constructor(a,t){super(t.getConfig())}onDisconnect(){return this.destroy()}commandLock(a,t,r){return a.action(o=>{if(!o.session)return o.next();const s=r.idFactory(o.session);if(!s)return o.next();const C=t.map(y=>`koishi:${r.prefix}:${s}:${y}`);return this.lock(C,o.next)},!0)}commandUserLock(a,t){return this.commandLock(a.userFields(t),t,{idFactory:r=>r.userId,prefix:"user"})}commandChannelLock(a,t){return this.commandLock(a.channelFields(t),t,{idFactory:r=>r.channelId,prefix:"channel"})}commandGuildLock(a,t){return this.commandLock(a.channelFields(t),t,{idFactory:r=>r.guildId||r.channelId,prefix:"guild"})}},"AragamiPlugin");l=k([(0,n.PluginSchema)(m.AragamiConfig),(0,n.Provide)("aragami",{immediate:!0}),(0,n.DefinePlugin)({name:"cache-aragami"}),g("design:paramtypes",[h.Context,Object])],l),i.default=l,u=new _.WrapDecoratorBuilder(e=>(e.ctx||e.__ctx).aragami).build(),i.UseCache=u.UseCache,i.UseLock=u.UseLock,i.CommandUserLock=n.koishiRegistrar.decorateCommandTransformer((e,a,...t)=>e.aragami.commandUserLock(a,t)),i.CommandChannelLock=n.koishiRegistrar.decorateCommandTransformer((e,a,...t)=>e.aragami.commandChannelLock(a,t)),i.CommandGuildLock=n.koishiRegistrar.decorateCommandTransformer((e,a,...t)=>e.aragami.commandGuildLock(a,t)),i.PutLockingUser=n.koishiRegistrar.decorateCommandPut((e,...a)=>e.argv.session.user,(e,...a)=>e.ctx.aragami.commandUserLock(e.command,a)),i.PutLockingChannel=n.koishiRegistrar.decorateCommandPut((e,...a)=>e.argv.session.channel,(e,...a)=>e.ctx.aragami.commandChannelLock(e.command,a)),i.PutLockingGuild=n.koishiRegistrar.decorateCommandPut((e,...a)=>e.argv.session.guild,(e,...a)=>e.ctx.aragami.commandGuildLock(e.command,a))},896:d=>{d.exports=require("aragami")},126:d=>{d.exports=require("koishi")},856:d=>{d.exports=require("koishi-thirdeye")}},v={};function b(d){var i=v[d];if(i!==void 0)return i.exports;var c=v[d]={exports:{}};return P[d].call(c.exports,c,c.exports,b),c.exports}L(b,"__webpack_require__");var R=b(607),j=exports;for(var O in R)j[O]=R[O];R.__esModule&&Object.defineProperty(j,"__esModule",{value:!0})})();

//# sourceMappingURL=index.js.map
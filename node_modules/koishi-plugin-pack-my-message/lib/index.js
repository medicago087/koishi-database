"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.apply = exports.Config = exports.name = void 0;
const koishi_1 = require("koishi");
exports.name = "pack-my-message";
exports.Config = koishi_1.Schema.object({});
function apply(ctx) {
    ctx.command("#pack").action(({ session }) => {
        // 整出一个bot对象
        var { bot } = session;
        // 这是最开始那段text
        var startText = session.elements[0];
        // 去掉命令
        startText.attrs.content = startText.attrs.content.replace("#pack", "");
        const attrs = {
            userId: session.userId,
            nickname: session.author?.nickname || session.username,
        };
        var elements = [];
        elements.push(startText);
        for (const iterator of session.elements.slice(1)) {
            elements.push((0, koishi_1.segment)("message", attrs, [iterator]));
        }
        // console.log(attrs);
        // 撤回消息
        bot.deleteMessage(session.channelId, session.messageId);
        // 丢出去
        return (0, koishi_1.segment)("message", { ...attrs, forward: true }, [
            (0, koishi_1.segment)("message", attrs, [`本打包消息由 ${session.userId} 打包\n`]),
            ...elements,
        ]);
    });
}
exports.apply = apply;

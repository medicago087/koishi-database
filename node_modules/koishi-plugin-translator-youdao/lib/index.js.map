{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { createHash } from 'crypto'\nimport { Schema } from 'koishi'\nimport Translator from '@koishijs/translator'\n\nfunction encrypt(source: string) {\n  return createHash('md5').update(source).digest('hex') // lgtm [js/weak-cryptographic-algorithm]\n}\n\nclass YoudaoTranslator extends Translator<YoudaoTranslator.Config> {\n  async translate(options?: Translator.Result) {\n    const { appKey, secret } = this.config\n    const salt = new Date().getTime()\n    const q = options.input\n    // 虽然文档中写了超过 20 字符的处理方法, 实测如果按照文档反而无法通过校验\n    // const qShort = q.length > 20 ? q.slice(0, 10) + q.length + q.slice(-10) : q\n    const from = options.source || ''\n    const to = options.target || 'zh-CHS'\n    const sign = encrypt(appKey + q + salt + secret)\n    const data = await this.ctx.http.get('http://openapi.youdao.com/api', {\n      params: { q, appKey, salt, from, to, sign },\n    })\n\n    if (+data.errorCode) {\n      throw new Error('errorCode: ' + data.errorCode)\n    }\n\n    const output: string[] = data.translation\n    if (options.detail && data.basic) {\n      if (data.basic.phonetic) {\n        output.push(data.basic.phonetic)\n      }\n      output.push(...data.basic.explains)\n    }\n    [options.source, options.target] = data.l.split('2')\n    return output.join('\\n')\n  }\n}\n\nnamespace YoudaoTranslator {\n  export interface Config extends Translator.Config {\n    appKey?: string\n    secret?: string\n  }\n\n  export const Config: Schema<Config> = Schema.object({\n    appKey: Schema.string().required().description('有道翻译的 App Key。'),\n    secret: Schema.string().role('secret').required().description('有道翻译的 Secret。'),\n  })\n}\n\nexport default YoudaoTranslator\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAA2B;AAC3B,oBAAuB;AACvB,wBAAuB;AAEvB,SAAS,QAAQ,QAAgB;AAC/B,aAAO,0BAAW,KAAK,EAAE,OAAO,MAAM,EAAE,OAAO,KAAK;AACtD;AAFS;AAIT,IAAM,mBAAN,cAA+B,kBAAAA,QAAoC;AAAA,EACjE,MAAM,UAAU,SAA6B;AAC3C,UAAM,EAAE,QAAQ,OAAO,IAAI,KAAK;AAChC,UAAM,OAAO,IAAI,KAAK,EAAE,QAAQ;AAChC,UAAM,IAAI,QAAQ;AAGlB,UAAM,OAAO,QAAQ,UAAU;AAC/B,UAAM,KAAK,QAAQ,UAAU;AAC7B,UAAM,OAAO,QAAQ,SAAS,IAAI,OAAO,MAAM;AAC/C,UAAM,OAAO,MAAM,KAAK,IAAI,KAAK,IAAI,iCAAiC;AAAA,MACpE,QAAQ,EAAE,GAAG,QAAQ,MAAM,MAAM,IAAI,KAAK;AAAA,IAC5C,CAAC;AAED,QAAI,CAAC,KAAK,WAAW;AACnB,YAAM,IAAI,MAAM,gBAAgB,KAAK,SAAS;AAAA,IAChD;AAEA,UAAM,SAAmB,KAAK;AAC9B,QAAI,QAAQ,UAAU,KAAK,OAAO;AAChC,UAAI,KAAK,MAAM,UAAU;AACvB,eAAO,KAAK,KAAK,MAAM,QAAQ;AAAA,MACjC;AACA,aAAO,KAAK,GAAG,KAAK,MAAM,QAAQ;AAAA,IACpC;AACA,KAAC,QAAQ,QAAQ,QAAQ,MAAM,IAAI,KAAK,EAAE,MAAM,GAAG;AACnD,WAAO,OAAO,KAAK,IAAI;AAAA,EACzB;AACF;AA5BM;AAAA,CA8BN,CAAUC,sBAAV;AAMS,EAAMA,kBAAA,SAAyB,qBAAO,OAAO;AAAA,IAClD,QAAQ,qBAAO,OAAO,EAAE,SAAS,EAAE,YAAY,gBAAgB;AAAA,IAC/D,QAAQ,qBAAO,OAAO,EAAE,KAAK,QAAQ,EAAE,SAAS,EAAE,YAAY,eAAe;AAAA,EAC/E,CAAC;AAAA,GATO;AAYV,IAAO,cAAQ;",
  "names": ["Translator", "YoudaoTranslator"]
}

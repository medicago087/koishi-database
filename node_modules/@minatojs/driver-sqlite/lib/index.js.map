{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { deepEqual, Dict, difference, isNullable, makeArray, union } from 'cosmokit'\nimport { Database, Driver, Eval, executeUpdate, Field, Model, Selection } from '@minatojs/core'\nimport { Builder, escape, escapeId } from '@minatojs/sql-utils'\nimport { promises as fs } from 'fs'\nimport init from '@minatojs/sql.js'\nimport Logger from 'reggol'\n\nconst logger = new Logger('sqlite')\n\nfunction getTypeDef({ type }: Field) {\n  switch (type) {\n    case 'boolean':\n    case 'integer':\n    case 'unsigned':\n    case 'date':\n    case 'time':\n    case 'timestamp': return `INTEGER`\n    case 'float':\n    case 'double':\n    case 'decimal': return `REAL`\n    case 'char':\n    case 'string':\n    case 'text':\n    case 'list':\n    case 'json': return `TEXT`\n  }\n}\n\nexport interface SQLiteFieldInfo {\n  cid: number\n  name: string\n  type: string\n  notnull: number\n  dflt_value: string\n  pk: boolean\n}\n\nnamespace SQLiteDriver {\n  export interface Config {\n    path: string\n  }\n}\n\nclass SQLiteBuilder extends Builder {\n  constructor(tables: Dict<Model>) {\n    super(tables)\n\n    this.evalOperators.$if = (args) => `iif(${args.map(arg => this.parseEval(arg)).join(', ')})`\n\n    this.define<boolean, number>({\n      types: ['boolean'],\n      dump: value => +value,\n      load: (value) => !!value,\n    })\n\n    this.define<object, string>({\n      types: ['json'],\n      dump: value => JSON.stringify(value),\n      load: (value, initial) => value ? JSON.parse(value) : initial,\n    })\n\n    this.define<string[], string>({\n      types: ['list'],\n      dump: value => value.join(','),\n      load: (value) => value ? value.split(',') : [],\n    })\n\n    this.define<Date, number>({\n      types: ['date', 'time', 'timestamp'],\n      dump: value => value === null ? null : +value,\n      load: (value) => value === null ? null : new Date(value),\n    })\n  }\n\n  escape(value: any, field?: Field<any>) {\n    if (value instanceof Date) value = +value\n    return super.escape(value, field)\n  }\n\n  protected createElementQuery(key: string, value: any) {\n    return `(',' || ${key} || ',') LIKE ${this.escape('%,' + value + ',%')}`\n  }\n}\n\nclass SQLiteDriver extends Driver {\n  db!: init.Database\n  sql: Builder\n  writeTask?: NodeJS.Timeout\n  sqlite!: init.SqlJsStatic\n\n  constructor(database: Database, public config: SQLiteDriver.Config) {\n    super(database)\n\n    this.sql = new SQLiteBuilder(database.tables)\n  }\n\n  /** synchronize table schema */\n  async prepare(table: string) {\n    const info = this.#all(`PRAGMA table_info(${escapeId(table)})`) as SQLiteFieldInfo[]\n    const model = this.model(table)\n    const columnDefs: string[] = []\n    const indexDefs: string[] = []\n    const alter: string[] = []\n    const mapping: Dict<string> = {}\n    let shouldMigrate = false\n\n    // field definitions\n    for (const key in model.fields) {\n      const legacy = [key, ...model.fields[key]!.legacy || []]\n      const column = info.find(({ name }) => legacy.includes(name))\n      const { initial, nullable = true } = model.fields[key]!\n      const typedef = getTypeDef(model.fields[key]!)\n      let def = `${escapeId(key)} ${typedef}`\n      if (key === model.primary && model.autoInc) {\n        def += ' NOT NULL PRIMARY KEY AUTOINCREMENT'\n      } else {\n        def += (nullable ? ' ' : ' NOT ') + 'NULL'\n        if (!isNullable(initial)) {\n          def += ' DEFAULT ' + this.sql.escape(this.sql.dump(model, { [key]: initial })[key])\n        }\n      }\n      columnDefs.push(def)\n      if (!column) {\n        alter.push('ADD ' + def)\n      } else {\n        mapping[column.name] = key\n        shouldMigrate ||= column.name !== key || column.type !== typedef\n      }\n    }\n\n    // index definitions\n    if (model.primary && !model.autoInc) {\n      indexDefs.push(`PRIMARY KEY (${this.#joinKeys(makeArray(model.primary))})`)\n    }\n    if (model.unique) {\n      indexDefs.push(...model.unique.map(keys => `UNIQUE (${this.#joinKeys(makeArray(keys))})`))\n    }\n    if (model.foreign) {\n      indexDefs.push(...Object.entries(model.foreign).map(([key, value]) => {\n        const [table, key2] = value!\n        return `FOREIGN KEY (\\`${key}\\`) REFERENCES ${escapeId(table)} (\\`${key2}\\`)`\n      }))\n    }\n\n    if (!info.length) {\n      logger.info('auto creating table %c', table)\n      this.#run(`CREATE TABLE ${escapeId(table)} (${[...columnDefs, ...indexDefs].join(', ')})`)\n    } else if (shouldMigrate) {\n      // preserve old columns\n      for (const column of info) {\n        if (mapping[column.name]) continue\n        let def = `${escapeId(column.name)} ${column.type}`\n        def += (column.notnull ? ' NOT ' : ' ') + 'NULL'\n        if (column.pk) def += ' PRIMARY KEY'\n        if (column.dflt_value !== null) def += ' DEFAULT ' + escape(column.dflt_value)\n        columnDefs.push(def)\n        mapping[column.name] = column.name\n      }\n\n      const temp = table + '_temp'\n      const fields = Object.keys(mapping).map(escapeId).join(', ')\n      logger.info('auto migrating table %c', table)\n      this.#run(`CREATE TABLE ${escapeId(temp)} (${columnDefs.join(', ')})`)\n      try {\n        this.#run(`INSERT INTO ${escapeId(temp)} SELECT ${fields} FROM ${escapeId(table)}`)\n        this.#run(`DROP TABLE ${escapeId(table)}`)\n        this.#run(`CREATE TABLE ${escapeId(table)} (${[...columnDefs, ...indexDefs].join(', ')})`)\n        this.#run(`INSERT INTO ${escapeId(table)} SELECT * FROM ${escapeId(temp)}`)\n      } finally {\n        this.#run(`DROP TABLE ${escapeId(temp)}`)\n      }\n    } else if (alter.length) {\n      logger.info('auto updating table %c', table)\n      for (const def of alter) {\n        this.#run(`ALTER TABLE ${escapeId(table)} ${def}`)\n      }\n    }\n  }\n\n  init(buffer: ArrayLike<number> | null) {\n    this.db = new this.sqlite.Database(buffer)\n    this.db.create_function('regexp', (pattern, str) => +new RegExp(pattern).test(str))\n  }\n\n  async start() {\n    const [sqlite, buffer] = await Promise.all([\n      init(),\n      this.config.path === ':memory:' ? null : fs.readFile(this.config.path).catch<Buffer | null>(() => null),\n    ])\n    this.sqlite = sqlite\n    this.init(buffer)\n  }\n\n  #joinKeys(keys?: string[]) {\n    return keys?.length ? keys.map(key => `\\`${key}\\``).join(', ') : '*'\n  }\n\n  async stop() {\n    this.db.close()\n  }\n\n  #exec(sql: string, params: any, callback: (stmt: init.Statement) => any) {\n    try {\n      const stmt = this.db.prepare(sql)\n      const result = callback(stmt)\n      stmt.free()\n      logger.debug('> %s', sql)\n      return result\n    } catch (e) {\n      logger.warn('> %s', sql)\n      throw e\n    }\n  }\n\n  #all(sql: string, params: any = []) {\n    return this.#exec(sql, params, (stmt) => {\n      stmt.bind(params)\n      const result: any[] = []\n      while (stmt.step()) {\n        result.push(stmt.getAsObject())\n      }\n      return result\n    })\n  }\n\n  #get(sql: string, params: any = []) {\n    return this.#exec(sql, params, stmt => stmt.getAsObject(params))\n  }\n\n  #run(sql: string, params: any = [], callback?: () => any) {\n    this.#exec(sql, params, stmt => stmt.run(params))\n    const result = callback?.()\n    if (this.config.path) {\n      const data = this.db.export()\n      const timer = this.writeTask = setTimeout(() => {\n        if (this.writeTask !== timer) return\n        fs.writeFile(this.config.path, data)\n      }, 0)\n      this.init(data)\n    }\n    return result\n  }\n\n  async drop(table?: string) {\n    if (table) return this.#run(`DROP TABLE ${escapeId(table)}`)\n    const tables = Object.keys(this.database.tables)\n    for (const table of tables) {\n      this.#run(`DROP TABLE ${escapeId(table)}`)\n    }\n  }\n\n  async stats() {\n    const data = this.db.export()\n    this.init(data)\n    return { size: data.byteLength }\n  }\n\n  async remove(sel: Selection.Mutable) {\n    const { query, table } = sel\n    const filter = this.sql.parseQuery(query)\n    if (filter === '0') return\n    this.#run(`DELETE FROM ${escapeId(table)} WHERE ${filter}`)\n  }\n\n  async get(sel: Selection.Immutable) {\n    const { tables } = sel\n    const builder = new SQLiteBuilder(tables)\n    const sql = builder.get(sel)\n    if (!sql) return []\n    const rows = this.#all(sql)\n    return rows.map(row => this.sql.load(sel.model, row))\n  }\n\n  async eval(sel: Selection.Immutable, expr: Eval.Expr) {\n    const output = this.sql.parseEval(expr)\n    let sql = this.sql.get(sel.table as Selection)\n    const prefix = `SELECT ${output} AS value `\n    if (sql.startsWith('SELECT * ')) {\n      sql = prefix + sql.slice(9)\n    } else {\n      sql = `${prefix}FROM (${sql}) ${sql.ref}`\n    }\n    const { value } = this.#get(sql)\n    return value\n  }\n\n  #update(sel: Selection.Mutable, indexFields: string[], updateFields: string[], update: {}, data: {}) {\n    const { ref, table } = sel\n    const model = this.model(table)\n    const row = this.sql.dump(model, executeUpdate(data, update, ref))\n    const assignment = updateFields.map((key) => `${escapeId(key)} = ${this.sql.escape(row[key])}`).join(',')\n    const query = Object.fromEntries(indexFields.map(key => [key, row[key]]))\n    const filter = this.sql.parseQuery(query)\n    this.#run(`UPDATE ${escapeId(table)} SET ${assignment} WHERE ${filter}`)\n  }\n\n  async set(sel: Selection.Mutable, update: {}) {\n    const { model, table, query } = sel\n    const { primary, fields } = model\n    const updateFields = [...new Set(Object.keys(update).map((key) => {\n      return Object.keys(fields).find(field => field === key || key.startsWith(field + '.'))!\n    }))]\n    const primaryFields = makeArray(primary)\n    const data = await this.database.get(table, query, union(primaryFields, updateFields) as [])\n    for (const row of data) {\n      this.#update(sel, primaryFields, updateFields, update, row)\n    }\n  }\n\n  #create(table: string, data: {}) {\n    const model = this.model(table)\n    data = this.sql.dump(model, data)\n    const keys = Object.keys(data)\n    const sql = `INSERT INTO ${escapeId(table)} (${this.#joinKeys(keys)}) VALUES (${keys.map(key => this.sql.escape(data[key])).join(', ')})`\n    return this.#run(sql, [], () => this.#get(`SELECT last_insert_rowid() AS id`))\n  }\n\n  async create(sel: Selection.Mutable, data: {}) {\n    const { model, table } = sel\n    data = model.create(data)\n    const { id } = this.#create(table, data)\n    const { autoInc, primary } = model\n    if (!autoInc || Array.isArray(primary)) return data as any\n    return { ...data, [primary]: id }\n  }\n\n  async upsert(sel: Selection.Mutable, data: any[], keys: string[]) {\n    if (!data.length) return\n    const { model, table, ref } = sel\n    const dataFields = [...new Set(Object.keys(Object.assign({}, ...data)).map((key) => {\n      return Object.keys(model.fields).find(field => field === key || key.startsWith(field + '.'))!\n    }))]\n    const relaventFields = union(keys, dataFields)\n    const updateFields = difference(dataFields, keys)\n    const results = await this.database.get(table, {\n      $or: data.map(item => Object.fromEntries(keys.map(key => [key, item[key]]))),\n    }, relaventFields as [])\n    for (const item of data) {\n      const row = results.find(row => keys.every(key => deepEqual(row[key], item[key], true)))\n      if (row) {\n        this.#update(sel, keys, updateFields, item, row)\n      } else {\n        this.#create(table, executeUpdate(model.create(), item, ref))\n      }\n    }\n  }\n}\n\nexport default SQLiteDriver\n"],
  "mappings": "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",
  "names": ["Logger", "table", "init", "fs", "row"]
}

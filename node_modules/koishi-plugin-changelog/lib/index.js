"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const koishi_1 = require("koishi");
const plugin_console_1 = require("@koishijs/plugin-console");
const path_1 = require("path");
class ReleaseProvider extends plugin_console_1.DataService {
    static using = ['console'];
    static schema = koishi_1.Schema.object({});
    cache;
    constructor(ctx) {
        super(ctx, 'releases');
        ctx.console.addEntry({
            dev: (0, path_1.resolve)(__dirname, '../client/index.ts'),
            prod: (0, path_1.resolve)(__dirname, '../dist'),
        });
    }
    async get(forced = false) {
        if (!forced && this.cache)
            return this.cache;
        return this.cache = this.ctx.http.get('https://api.github.com/repos/koishijs/koishi/releases', {
            params: { per_page: 100 },
        }).catch(() => {
            delete this.cache;
        });
    }
}
exports.default = ReleaseProvider;

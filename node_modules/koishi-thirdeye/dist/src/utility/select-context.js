"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.selectContext = void 0;
const koishi_1 = require("koishi");
const selectors = [
    'user',
    'guild',
    'channel',
    'self',
    'private',
    'platform',
];
function selectContext(root, options) {
    let ctx = root;
    // basic selectors
    for (const type of selectors) {
        const value = options[type];
        if (value === true) {
            ctx = ctx[type]();
        }
        else if (value === false) {
            ctx = ctx.exclude(ctx[type]());
        }
        else if (value !== undefined) {
            // we turn everything into string
            ctx = ctx[type](...(0, koishi_1.makeArray)(value).map((item) => '' + item));
        }
    }
    // intersect
    if (options.and) {
        for (const selection of options.and) {
            ctx = ctx.intersect(selectContext(root, selection));
        }
    }
    // union
    if (options.or) {
        let ctx2 = ctx.never();
        for (const selection of options.or) {
            ctx2 = ctx2.union(selectContext(root, selection));
        }
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore
        ctx = ctx.intersect(ctx2);
    }
    // exclude
    if (options.not) {
        ctx = ctx.exclude(selectContext(root, options.not));
    }
    return ctx;
}
exports.selectContext = selectContext;
//# sourceMappingURL=select-context.js.map
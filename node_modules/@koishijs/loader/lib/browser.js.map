{
  "version": 3,
  "sources": ["../src/browser.ts"],
  "sourcesContent": ["import { Context } from 'koishi'\nimport { Loader, unwrapExports } from './shared'\nimport { MarketResult, SearchResult } from '@koishijs/registry'\n\nexport default class BrowserLoader extends Loader {\n  public extname: string\n  public meta = Object.create(null)\n  private _initTask: Promise<void>\n\n  constructor(public baseDir: string) {\n    super()\n    this.config = { plugins: {} }\n  }\n\n  private async prepare() {\n    const [search, market]: [SearchResult, MarketResult] = await Promise.all([\n      fetch(this.baseDir + '/index.json').then(res => res.json()),\n      fetch(this.baseDir + '/market.json').then(res => res.json()),\n    ])\n    for (const object of search.objects) {\n      if (!object.portable) continue\n      const { name } = object.package\n      const key = name.replace(/(koishi-|^@koishijs\\/)plugin-/, '')\n      const item = market.objects.find(item => item.name === name)\n      this.cache[key] = `${this.baseDir}/modules/${name}@${item.version}/index.js`\n      this.meta[key] = item.versions[item.version]\n    }\n  }\n\n  readConfig() {\n    return new Context.Config()\n  }\n\n  writeConfig() {\n  }\n\n  async resolvePlugin(name: string) {\n    await (this._initTask ||= this.prepare())\n    try {\n      return unwrapExports(await import(this.cache[name]))\n    } catch (err) {\n      console.error(err)\n    }\n  }\n\n  async getPluginMeta(name: string) {\n    await (this._initTask ||= this.prepare())\n    return this.meta[name]\n  }\n\n  fullReload() {\n    console.info('trigger full reload')\n  }\n}\n"],
  "mappings": ";;;;AAAA,SAAS,eAAe;AACxB,SAAS,QAAQ,qBAAqB;AAGtC,IAAqB,gBAArB,cAA2C,OAAO;AAAA,EAKhD,YAAmB,SAAiB;AAClC,UAAM;AADW;AAEjB,SAAK,SAAS,EAAE,SAAS,CAAC,EAAE;AAAA,EAC9B;AAAA,EAPO;AAAA,EACA,OAAO,uBAAO,OAAO,IAAI;AAAA,EACxB;AAAA,EAOR,MAAc,UAAU;AACtB,UAAM,CAAC,QAAQ,MAAM,IAAkC,MAAM,QAAQ,IAAI;AAAA,MACvE,MAAM,KAAK,UAAU,aAAa,EAAE,KAAK,SAAO,IAAI,KAAK,CAAC;AAAA,MAC1D,MAAM,KAAK,UAAU,cAAc,EAAE,KAAK,SAAO,IAAI,KAAK,CAAC;AAAA,IAC7D,CAAC;AACD,eAAW,UAAU,OAAO,SAAS;AACnC,UAAI,CAAC,OAAO;AAAU;AACtB,YAAM,EAAE,KAAK,IAAI,OAAO;AACxB,YAAM,MAAM,KAAK,QAAQ,iCAAiC,EAAE;AAC5D,YAAM,OAAO,OAAO,QAAQ,KAAK,CAAAA,UAAQA,MAAK,SAAS,IAAI;AAC3D,WAAK,MAAM,OAAO,GAAG,KAAK,mBAAmB,QAAQ,KAAK;AAC1D,WAAK,KAAK,OAAO,KAAK,SAAS,KAAK;AAAA,IACtC;AAAA,EACF;AAAA,EAEA,aAAa;AACX,WAAO,IAAI,QAAQ,OAAO;AAAA,EAC5B;AAAA,EAEA,cAAc;AAAA,EACd;AAAA,EAEA,MAAM,cAAc,MAAc;AAChC,WAAO,KAAK,cAAc,KAAK,QAAQ;AACvC,QAAI;AACF,aAAO,cAAc,MAAM,OAAO,KAAK,MAAM,MAAM;AAAA,IACrD,SAAS,KAAP;AACA,cAAQ,MAAM,GAAG;AAAA,IACnB;AAAA,EACF;AAAA,EAEA,MAAM,cAAc,MAAc;AAChC,WAAO,KAAK,cAAc,KAAK,QAAQ;AACvC,WAAO,KAAK,KAAK;AAAA,EACnB;AAAA,EAEA,aAAa;AACX,YAAQ,KAAK,qBAAqB;AAAA,EACpC;AACF;AAjDqB;",
  "names": ["item"]
}

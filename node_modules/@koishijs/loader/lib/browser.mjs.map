{
  "version": 3,
  "sources": ["../src/browser.ts"],
  "sourcesContent": ["import { makeArray } from 'koishi'\nimport { Loader, unwrapExports } from './shared'\nimport { MarketResult } from '@koishijs/registry'\n\nexport * from './shared'\n\nfunction resolveName(name: string) {\n  if (name[0] === '@') {\n    const [left, right] = name.split('/')\n    return [`${left}/koishi-plugin-${right}`]\n  } else {\n    return [`@koishijs/plugin-${name}`, `koishi-plugin-${name}`]\n  }\n}\n\nexport default class BrowserLoader extends Loader {\n  public extname: string\n  public config = { plugins: {} }\n  private _initTask: Promise<void>\n\n  constructor() {\n    super()\n  }\n\n  private async prepare() {\n    if (!process.env.KOISHI_REGISTRY) return\n    const market: MarketResult = await fetch(process.env.KOISHI_REGISTRY + '/market.json').then(res => res.json())\n    for (const object of market.objects) {\n      this.cache[object.shortname] = `${process.env.KOISHI_REGISTRY}/modules/${object.name}/index.js`\n    }\n  }\n\n  readConfig() {\n    return null\n  }\n\n  writeConfig() {\n    this.app.emit('config')\n  }\n\n  async resolvePlugin(name: string) {\n    await (this._initTask ||= this.prepare())\n    const urls = process.env.KOISHI_REGISTRY\n      ? makeArray(this.cache[name])\n      : resolveName(name).map(name => `/modules/${name}/index.js`)\n    for (const url of urls) {\n      try {\n        return unwrapExports(await import(/* @vite-ignore */ url))\n      } catch (err) {}\n    }\n    console.error(`cannot resolve plugin ${name}`)\n  }\n\n  fullReload() {\n    console.info('trigger full reload')\n  }\n}\n"],
  "mappings": ";;;;AAAA,SAAS,iBAAiB;AAC1B,SAAS,QAAQ,qBAAqB;AAGtC,cAAc;AAEd,SAAS,YAAY,MAAc;AACjC,MAAI,KAAK,OAAO,KAAK;AACnB,UAAM,CAAC,MAAM,KAAK,IAAI,KAAK,MAAM,GAAG;AACpC,WAAO,CAAC,GAAG,sBAAsB,OAAO;AAAA,EAC1C,OAAO;AACL,WAAO,CAAC,oBAAoB,QAAQ,iBAAiB,MAAM;AAAA,EAC7D;AACF;AAPS;AAST,IAAqB,gBAArB,cAA2C,OAAO;AAAA,EACzC;AAAA,EACA,SAAS,EAAE,SAAS,CAAC,EAAE;AAAA,EACtB;AAAA,EAER,cAAc;AACZ,UAAM;AAAA,EACR;AAAA,EAEA,MAAc,UAAU;AACtB,QAAI,CAAC,QAAQ,IAAI;AAAiB;AAClC,UAAM,SAAuB,MAAM,MAAM,QAAQ,IAAI,kBAAkB,cAAc,EAAE,KAAK,SAAO,IAAI,KAAK,CAAC;AAC7G,eAAW,UAAU,OAAO,SAAS;AACnC,WAAK,MAAM,OAAO,aAAa,GAAG,QAAQ,IAAI,2BAA2B,OAAO;AAAA,IAClF;AAAA,EACF;AAAA,EAEA,aAAa;AACX,WAAO;AAAA,EACT;AAAA,EAEA,cAAc;AACZ,SAAK,IAAI,KAAK,QAAQ;AAAA,EACxB;AAAA,EAEA,MAAM,cAAc,MAAc;AAChC,WAAO,KAAK,cAAc,KAAK,QAAQ;AACvC,UAAM,OAAO,QAAQ,IAAI,kBACrB,UAAU,KAAK,MAAM,KAAK,IAC1B,YAAY,IAAI,EAAE,IAAI,CAAAA,UAAQ,YAAYA,gBAAe;AAC7D,eAAW,OAAO,MAAM;AACtB,UAAI;AACF,eAAO,cAAc,MAAM;AAAA;AAAA,UAA0B;AAAA,SAAI;AAAA,MAC3D,SAAS,KAAP;AAAA,MAAa;AAAA,IACjB;AACA,YAAQ,MAAM,yBAAyB,MAAM;AAAA,EAC/C;AAAA,EAEA,aAAa;AACX,YAAQ,KAAK,qBAAqB;AAAA,EACpC;AACF;AAzCqB;",
  "names": ["name"]
}

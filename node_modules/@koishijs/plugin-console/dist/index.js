var U=Object.defineProperty;var q=(e,t,o)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var b=(e,t,o)=>(q(e,typeof t!="symbol"?t+"":t,o),o);import{reactive as z,defineComponent as g,computed as N,resolveComponent as _,openBlock as c,createBlock as m,withCtx as f,createElementVNode as v,toDisplayString as D,createElementBlock as d,createCommentVNode as w,unref as p,createVNode as l,withModifiers as G,renderSlot as H,Fragment as E,renderList as x,resolveDirective as J,normalizeClass as Q,KeepAlive as X,resolveDynamicComponent as Y,withDirectives as Z,createTextVNode as A,createApp as ee}from"./vue.js";import{useWindowSize as te,useLocalStorage as ne,useDark as oe}from"./vueuse.js";import se,{router as $,activities as ce,store as re,isLeftAsideOpen as ie,config as O,root as R,connect as K}from"./client.js";import{useRoute as ae}from"./vue-router.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const I=z({});$.afterEach(()=>{const{name:e,fullPath:t}=$.currentRoute.value;I[e]=t});const ue={class:"title"},le={key:0,class:"desc"},L=g({__name:"activity-item",props:{data:null,placement:null},setup(e){const t=e,o=N(()=>I[t.data.id]||t.data.path.replace(/:.+/,""));return(r,s)=>{const n=_("k-icon"),a=_("router-link"),i=_("el-tooltip");return c(),m(i,{placement:e.placement,"popper-class":"activity-item-tooltip"},{content:f(()=>[v("div",ue,D(e.data.name),1),e.data.desc?(c(),d("div",le,D(e.data.desc),1)):w("",!0)]),default:f(()=>[e.data.path?(c(),m(a,{key:0,class:"navbar-item",to:p(o)},{default:f(()=>[l(n,{class:"menu-icon",name:e.data.icon},null,8,["name"])]),_:1},8,["to"])):(c(),d("div",{key:1,class:"navbar-item",onClick:s[0]||(s[0]=G((...u)=>e.data.action&&e.data.action(...u),["stop"]))},[l(n,{class:"menu-icon",name:e.data.icon},null,8,["name"])]))]),_:1},8,["placement"])}}});const P=(e,t)=>{const o=e.__vccOpts||e;for(const[r,s]of t)o[r]=s;return o},_e={},de={class:"navbar-item"};function me(e,t){const o=_("k-icon"),r=_("el-tooltip");return c(),m(r,{placement:"right","popper-class":"activity-group-tooltip"},{content:f(()=>[H(e.$slots,"default")]),default:f(()=>[v("div",de,[l(o,{class:"menu-icon",name:"activity:ellipsis"})])]),_:3})}const pe=P(_e,[["render",me]]),fe={class:"layout-activity"},he={key:1,class:"spacer"},ve=g({__name:"activity-bar",setup(e){const{height:t}=te(),o=N(()=>{let r;const s=Object.values(ce).filter(i=>i.position).sort((i,u)=>i.order-u.order);s.length*64>t.value&&(r=s.splice(0,s.length+1-Math.floor(t.value/64)).sort((i,u)=>{const h=i.position==="top"?-1:1;return i.position===u.position?h*(i.order-u.order):h}));const n=s.filter(i=>i.position==="top").reverse(),a=s.filter(i=>i.position==="bottom");return{top:n,bottom:a,hidden:r}});return(r,s)=>(c(),d("nav",fe,[(c(!0),d(E,null,x(p(o).top,n=>(c(),m(L,{placement:"right",key:n.id,data:n},null,8,["data"]))),128)),p(o).hidden?(c(),m(pe,{key:0},{default:f(()=>[(c(!0),d(E,null,x(p(o).hidden,n=>(c(),m(L,{placement:"bottom",key:n.id,data:n},null,8,["data"]))),128))]),_:1})):(c(),d("div",he)),(c(!0),d(E,null,x(p(o).bottom,n=>(c(),m(L,{placement:"right",key:n.id,data:n},null,8,["data"]))),128))]))}});const ye=P(ve,[["__scopeId","data-v-332b3fff"]]);const ke={},ge={class:"layout-status"};function Be(e,t){const o=_("k-slot");return c(),d("footer",ge,[l(o,{name:"status-left"}),l(o,{name:"status-right"})])}const Ee=P(ke,[["render",Be]]),Fe={key:1,class:"loading","element-loading-text":"\u6B63\u5728\u52A0\u8F7D\u6570\u636E\u2026\u2026"},be=g({__name:"index",setup(e){const t=ae(),o=N(()=>{var r;return(r=t.meta.activity)!=null&&r.fields?t.meta.activity.fields.every(s=>re[s]):!0});return(r,s)=>{const n=_("router-view"),a=_("k-slot"),i=J("loading");return c(),d("div",{class:Q({"is-left-aside-open":p(ie)})},[l(ye),p(o)?(c(),m(n,{key:0},{default:f(({Component:u})=>[(c(),m(X,null,[(c(),m(Y(u)))],1024))]),_:1})):Z((c(),d("div",Fe,null,512)),[[i,!0]]),l(Ee),l(a,{name:"global"})],2)}}}),Ce={class:"k-card welcome"},we=v("h1",null,"\u6B22\u8FCE\u4F7F\u7528 Koishi\uFF01",-1),xe=v("p",null,"\u4F60\u7684\u673A\u5668\u4EBA\u5DF2\u7ECF\u51C6\u5907\u5C31\u7EEA\u3002\u70B9\u51FB\u4E0B\u9762\u7684\u4EFB\u4E00\u9009\u9879\uFF0C\u5F00\u542F\u4F60\u7684 Koishi \u4E4B\u65C5\u5427\u3002",-1),$e=v("h2",null,"\u9605\u8BFB\u6587\u6863",-1),Se=v("p",null,"\u5F00\u59CB\u9605\u8BFB\u5B98\u65B9\u6587\u6863\u3002\u5B98\u65B9\u6587\u6863\u91CC\u5305\u542B\u4E86\u4F60\u60F3\u8981\u4E86\u89E3\u7684\u5168\u90E8\u5185\u5BB9\u3002",-1),Ae=[$e,Se],Le=g({__name:"welcome",setup(e){function t(){window.open("https://koishi.chat","_blank")}return(o,r)=>{const s=_("k-slot");return c(),d("div",Ce,[we,xe,l(s,{name:"welcome-choice",class:"choices"},{default:f(()=>[v("div",{class:"choice",onClick:t},Ae)]),_:1})])}}});const De=g({__name:"home",setup(e){return(t,o)=>{const r=_("k-slot"),s=_("el-scrollbar"),n=_("k-layout");return c(),m(n,{main:"darker",class:"page-home"},{default:f(()=>[l(s,null,{default:f(()=>[l(Le),l(r,{name:"home"}),l(r,{name:"numeric",class:"card-grid profile-grid"}),l(r,{name:"chart",class:"card-grid chart-grid"})]),_:1})]),_:1})}}});const Oe="modulepreload",Ne=function(e){return"/"+e},V={},Re=function(t,o,r){if(!o||o.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(o.map(n=>{if(n=Ne(n),n in V)return;V[n]=!0;const a=n.endsWith(".css"),i=a?'[rel="stylesheet"]':"";if(!!r)for(let B=s.length-1;B>=0;B--){const F=s[B];if(F.href===n&&(!a||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${i}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":Oe,a||(h.as="script",h.crossOrigin=""),h.href=n,document.head.appendChild(h),a)return new Promise((B,F)=>{h.addEventListener("load",B),h.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())},j=1;function Pe(e){const t=ne("koishi-play",{});return t.value.version!==j?t.value={...e,version:j}:t.value={...e,...t.value},t}const y=Pe({current:null,instances:{}});let k;function T(){const e=Math.random().toString(36).slice(2,10);y.value.current=e,y.value.instances[e]={plugins:{console:{},help:{},sandbox:{},market:{}}},k&&W(e)}async function W(e){var o;await((o=k.app)==null?void 0:o.stop()),y.value.current=e,k.config=y.value.instances[e],await(await k.createApp()).start()}Object.keys(y.value.instances).length||T();async function We(){if(k)return k;const e=O.endpoint+"/modules/@koishijs/loader/index.js",{default:t}=await Re(()=>import(e),[]);return k=new t}const Ke=v("span",null,"\u5B9E\u4F8B\u7BA1\u7406",-1),Ve={class:"name"},je={class:"actions"},Ie=g({__name:"index",setup(e){function t(o){delete y.value.instances[o]}return(o,r)=>{const s=_("k-button"),n=_("k-icon"),a=_("k-card");return c(),m(a,{class:"instances"},{header:f(()=>[Ke,l(s,{class:"right",onClick:p(T)},{default:f(()=>[A("\u6DFB\u52A0")]),_:1},8,["onClick"])]),default:f(()=>[v("table",null,[(c(!0),d(E,null,x(p(y).instances,(i,u)=>(c(),d("tr",{class:"instance",key:u},[v("td",Ve,[A(D(i.name||u)+" ",1),p(y).current===u?(c(),d(E,{key:0},[A("(\u8FD0\u884C\u4E2D)")],64)):w("",!0)]),v("td",je,[v("span",null,[p(y).current!==u?(c(),m(n,{key:0,name:"start",onClick:h=>p(W)(u)},null,8,["onClick"])):w("",!0),p(y).current!==u?(c(),m(n,{key:1,name:"delete",onClick:h=>t(u)},null,8,["onClick"])):w("",!0)])])]))),128))])]),_:1})}}});class M{constructor(){b(this,"remote")}onopen(t){}onmessage(t){}onclose(t){}onerror(t){}send(t){this.remote.onmessage({data:t})}}class Te extends M{constructor(o){super();b(this,"app");this.remote=o,this.start()}async start(){const o=await We();o[Symbol.for("koishi.socket")]=this,await W(y.value.current)}}class Me extends M{constructor(){super();b(this,"remote",new Te(this));this.onopen({}),R.slot({type:"home",order:900,component:Ie})}}const S=ee(be);S.use(se);S.provide("ecTheme","dark-blue");R.page({path:"/",name:"\u6B22\u8FCE",icon:"activity:home",order:1e3,component:De});const C=oe();R.page({id:"dark-mode",position:"bottom",order:-100,name:()=>C.value?"\u6697\u9ED1\u6A21\u5F0F":"\u660E\u4EAE\u6A21\u5F0F",icon:()=>"activity:"+(C.value?"moon":"sun"),action:()=>C.value=!C.value});S.use($);$.afterEach(e=>{e.meta.activity&&(document.title=`${e.meta.activity.name} | Koishi \u63A7\u5236\u53F0`)});S.mount("#app");if(O.static)K(new Me);else{const e=new URL(O.endpoint,location.origin).toString();K(new WebSocket(e.replace(/^http/,"ws")))}

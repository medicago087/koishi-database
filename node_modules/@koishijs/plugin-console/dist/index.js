var U=Object.defineProperty;var q=(t,e,n)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var F=(t,e,n)=>(q(t,typeof e!="symbol"?e+"":e,n),n);import{reactive as z,defineComponent as y,computed as b,resolveComponent as _,openBlock as c,createBlock as v,withCtx as k,createElementVNode as l,toDisplayString as w,createElementBlock as p,createCommentVNode as C,createVNode as i,unref as m,Fragment as x,renderList as A,resolveDirective as M,normalizeClass as G,KeepAlive as H,resolveDynamicComponent as J,withDirectives as Q,createTextVNode as L,createApp as X}from"./vue.js";import Y,{router as $,store as W,routes as Z,root as O,getValue as ee,isLeftAsideOpen as te,config as D,connect as N}from"./client.js";import{useRoute as ne}from"./vue-router.js";import{useDark as oe,useLocalStorage as se}from"./vueuse.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))u(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&u(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function u(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const j=z({});$.afterEach(()=>{const{name:t,fullPath:e}=$.currentRoute.value;j[t]=e});const re={class:"title"},ce={key:0,class:"desc"},ue={key:0,class:"badge"},P=y({__name:"activity-item",props:{route:{}},setup(t){const e=t,n=b(()=>j[e.route.name]||e.route.path.replace(/:.+/,"")),u=b(()=>s.value?e.route.meta.badge.reduce((o,r)=>o+r(),0):0),s=b(()=>e.route.meta.fields?e.route.meta.fields.every(o=>W[o]):!0);return(o,r)=>{const a=_("k-icon"),d=_("router-link"),f=_("el-tooltip");return c(),v(f,{placement:"right","popper-class":"activity-item-tooltip"},{content:k(()=>[l("div",re,w(t.route.name),1),t.route.meta.desc?(c(),p("div",ce,w(t.route.meta.desc),1)):C("",!0)]),default:k(()=>[i(d,{class:"navbar-item",to:m(n)},{default:k(()=>[i(a,{class:"menu-icon",name:t.route.meta.icon||"application"},null,8,["name"])]),_:1},8,["to"]),m(u)?(c(),p("span",ue,w(m(u)),1)):C("",!0)]),_:1})}}});const ae={class:"layout-activity"},ie={class:"top"},le={class:"bottom"},_e=y({__name:"activity-bar",setup(t){function e(s){const o=s==="top"?1:-1;return Z.value.filter(r=>O.bail("activity",r.meta)?!1:ee(r.meta.position)===s).sort((r,a)=>o*(a.meta.order-r.meta.order))}const n=oe();function u(){n.value=!n.value}return(s,o)=>{const r=_("k-icon");return c(),p("nav",ae,[l("div",ie,[(c(!0),p(x,null,A(e("top"),a=>(c(),v(P,{key:a.name,route:a},null,8,["route"]))),128))]),l("div",le,[l("div",{class:"navbar-item",onClick:u},[i(r,{class:"menu-icon",name:"activity:"+(m(n)?"moon":"sun")},null,8,["name"])]),(c(!0),p(x,null,A(e("bottom"),a=>(c(),v(P,{key:a.name,route:a},null,8,["route"]))),128))])])}}});const de=(t,e)=>{const n=t.__vccOpts||t;for(const[u,s]of e)n[u]=s;return n},me={},pe={class:"layout-status"};function fe(t,e){const n=_("k-slot");return c(),p("footer",pe,[i(n,{name:"status-left"}),i(n,{name:"status-right"})])}const he=de(me,[["render",fe]]),ve={key:1,class:"loading","element-loading-text":"\u6B63\u5728\u52A0\u8F7D\u6570\u636E\u2026\u2026"},ke=y({__name:"index",setup(t){const e=ne(),n=b(()=>e.meta.fields?e.meta.fields.every(u=>W[u]):!0);return(u,s)=>{const o=_("router-view"),r=_("k-slot"),a=M("loading");return c(),p("div",{class:G({"is-left-aside-open":m(te)})},[i(_e),m(n)?(c(),v(o,{key:0},{default:k(({Component:d})=>[(c(),v(H,null,[(c(),v(J(d)))],1024))]),_:1})):Q((c(),p("div",ve,null,512)),[[a,!0]]),i(he),i(r,{name:"global"})],2)}}}),ge={class:"k-card welcome"},ye=l("h1",null,"\u6B22\u8FCE\u4F7F\u7528 Koishi\uFF01",-1),Be=l("p",null,"\u4F60\u7684\u673A\u5668\u4EBA\u5DF2\u7ECF\u51C6\u5907\u5C31\u7EEA\u3002\u70B9\u51FB\u4E0B\u9762\u7684\u4EFB\u4E00\u9009\u9879\uFF0C\u5F00\u542F\u4F60\u7684 Koishi \u4E4B\u65C5\u5427\u3002",-1),Ce=l("h2",null,"\u9605\u8BFB\u6587\u6863",-1),Ee=l("p",null,"\u5F00\u59CB\u9605\u8BFB\u5B98\u65B9\u6587\u6863\u3002\u5B98\u65B9\u6587\u6863\u91CC\u5305\u542B\u4E86\u4F60\u60F3\u8981\u4E86\u89E3\u7684\u5168\u90E8\u5185\u5BB9\u3002",-1),Fe=[Ce,Ee],be=y({__name:"welcome",setup(t){function e(){window.open("https://koishi.js.org","_blank")}return(n,u)=>{const s=_("k-slot");return c(),p("div",ge,[ye,Be,i(s,{name:"welcome-choice",class:"choices"},{default:k(()=>[l("div",{class:"choice",onClick:e},Fe)]),_:1})])}}});const we=y({__name:"home",setup(t){return(e,n)=>{const u=_("k-slot"),s=_("el-scrollbar"),o=_("k-layout");return c(),v(o,{main:"darker",class:"page-home"},{default:k(()=>[i(s,null,{default:k(()=>[i(be),i(u,{name:"home"}),i(u,{name:"numeric",class:"card-grid profile-grid"}),i(u,{name:"chart",class:"card-grid chart-grid"})]),_:1})]),_:1})}}});const xe="modulepreload",$e=function(t){return"/"+t},V={},Se=function(e,n,u){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=$e(o),o in V)return;V[o]=!0;const r=o.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(!!u)for(let B=s.length-1;B>=0;B--){const E=s[B];if(E.href===o&&(!r||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${a}`))return;const f=document.createElement("link");if(f.rel=r?"stylesheet":xe,r||(f.as="script",f.crossOrigin=""),f.href=o,document.head.appendChild(f),r)return new Promise((B,E)=>{f.addEventListener("load",B),f.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())},K=1;function Le(t){const e=se("koishi-play",{});return e.value.version!==K?e.value={...t,version:K}:e.value={...t,...e.value},e}const h=Le({current:null,instances:{}});let g;function T(){const t=Math.random().toString(36).slice(2,10);h.value.current=t,h.value.instances[t]={plugins:{console:{},help:{},sandbox:{},market:{}}},g&&R(t)}async function R(t){var n;await((n=g.app)==null?void 0:n.stop()),h.value.current=t,g.config=h.value.instances[t],await(await g.createApp()).start()}Object.keys(h.value.instances).length||T();async function Ae(){if(g)return g;const t=D.endpoint+"/modules/@koishijs/loader/index.js",{default:e}=await Se(()=>import(t),[]);return g=new e}const De=l("span",null,"\u5B9E\u4F8B\u7BA1\u7406",-1),Oe={class:"name"},Re={class:"actions"},Ne=y({__name:"index",setup(t){function e(n){delete h.value.instances[n]}return(n,u)=>{const s=_("k-button"),o=_("k-icon"),r=_("k-card");return c(),v(r,{class:"instances"},{header:k(()=>[De,i(s,{class:"right",onClick:m(T)},{default:k(()=>[L("\u6DFB\u52A0")]),_:1},8,["onClick"])]),default:k(()=>[l("table",null,[(c(!0),p(x,null,A(m(h).instances,(a,d)=>(c(),p("tr",{class:"instance",key:d},[l("td",Oe,[L(w(a.name||d)+" ",1),m(h).current===d?(c(),p(x,{key:0},[L("(\u8FD0\u884C\u4E2D)")],64)):C("",!0)]),l("td",Re,[l("span",null,[m(h).current!==d?(c(),v(o,{key:0,name:"start",onClick:f=>m(R)(d)},null,8,["onClick"])):C("",!0),m(h).current!==d?(c(),v(o,{key:1,name:"delete",onClick:f=>e(d)},null,8,["onClick"])):C("",!0)])])]))),128))])]),_:1})}}});class I{constructor(){F(this,"remote")}onopen(e){}onmessage(e){}onclose(e){}onerror(e){}send(e){this.remote.onmessage({data:e})}}class Pe extends I{constructor(n){super();F(this,"app");this.remote=n,this.start()}async start(){const n=await Ae();n[Symbol.for("koishi.socket")]=this,await R(h.value.current)}}class Ve extends I{constructor(){super();F(this,"remote",new Pe(this));this.onopen({}),O.slot({type:"home",order:900,component:Ne})}}const S=X(ke);S.use(Y);S.provide("ecTheme","dark-blue");O.page({path:"/",name:"\u6B22\u8FCE",icon:"activity:home",order:1e3,component:we});S.use($);$.afterEach(t=>{typeof t.name=="string"&&(document.title=`${t.name} | Koishi \u63A7\u5236\u53F0`)});S.mount("#app");if(D.static)N(new Ve);else{const t=new URL(D.endpoint,location.origin).toString();N(new WebSocket(t.replace(/^http/,"ws")))}

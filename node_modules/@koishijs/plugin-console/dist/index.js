var q=Object.defineProperty;var z=(t,e,n)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var F=(t,e,n)=>(z(t,typeof e!="symbol"?e+"":e,n),n);import{reactive as M,defineComponent as y,computed as b,resolveComponent as _,openBlock as c,createBlock as v,withCtx as k,createElementVNode as l,toDisplayString as w,createElementBlock as p,createCommentVNode as C,createVNode as i,unref as m,Fragment as x,renderList as A,resolveDirective as G,normalizeClass as H,KeepAlive as J,resolveDynamicComponent as Q,withDirectives as X,createTextVNode as L,createApp as Y}from"./vue.js";import Z,{router as $,store as W,routes as ee,root as O,getValue as te,isLeftAsideOpen as ne,config as D,connect as N}from"./client.js";import{useRoute as oe}from"./vue-router.js";import{useDark as se,useLocalStorage as re}from"./vueuse.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const I=M({});$.afterEach(()=>{const{name:t,fullPath:e}=$.currentRoute.value;I[t]=e});const ce={class:"title"},ae={key:0,class:"desc"},ue={key:0,class:"badge"},P=y({__name:"activity-item",props:{route:{}},setup(t){const e=t,n=b(()=>I[e.route.name]||e.route.path.replace(/:.+/,"")),a=b(()=>s.value?e.route.meta.badge.reduce((o,r)=>o+r(),0):0),s=b(()=>e.route.meta.fields?e.route.meta.fields.every(o=>W[o]):!0);return(o,r)=>{const u=_("k-icon"),d=_("router-link"),f=_("el-tooltip");return c(),v(f,{placement:"right","popper-class":"activity-item-tooltip"},{content:k(()=>[l("div",ce,w(t.route.name),1),t.route.meta.desc?(c(),p("div",ae,w(t.route.meta.desc),1)):C("",!0)]),default:k(()=>[i(d,{class:"navbar-item",to:m(n)},{default:k(()=>[i(u,{class:"menu-icon",name:t.route.meta.icon||"application"},null,8,["name"])]),_:1},8,["to"]),m(a)?(c(),p("span",ue,w(m(a)),1)):C("",!0)]),_:1})}}});const ie={class:"layout-activity"},le={class:"top"},_e={class:"bottom"},de=y({__name:"activity-bar",setup(t){function e(s){const o=s==="top"?1:-1;return ee.value.filter(r=>O.bail("activity",r.meta)?!1:te(r.meta.position)===s).sort((r,u)=>o*(u.meta.order-r.meta.order))}const n=se();function a(){n.value=!n.value}return(s,o)=>{const r=_("k-icon");return c(),p("nav",ie,[l("div",le,[(c(!0),p(x,null,A(e("top"),u=>(c(),v(P,{key:u.name,route:u},null,8,["route"]))),128))]),l("div",_e,[l("div",{class:"navbar-item",onClick:a},[i(r,{class:"menu-icon",name:"activity:"+(m(n)?"moon":"sun")},null,8,["name"])]),(c(!0),p(x,null,A(e("bottom"),u=>(c(),v(P,{key:u.name,route:u},null,8,["route"]))),128))])])}}});const T=(t,e)=>{const n=t.__vccOpts||t;for(const[a,s]of e)n[a]=s;return n},me=T(de,[["__scopeId","data-v-98c21702"]]);const pe={},fe={class:"layout-status"};function he(t,e){const n=_("k-slot");return c(),p("footer",fe,[i(n,{name:"status-left"}),i(n,{name:"status-right"})])}const ve=T(pe,[["render",he]]),ke={key:1,class:"loading","element-loading-text":"\u6B63\u5728\u52A0\u8F7D\u6570\u636E\u2026\u2026"},ge=y({__name:"index",setup(t){const e=oe(),n=b(()=>e.meta.fields?e.meta.fields.every(a=>W[a]):!0);return(a,s)=>{const o=_("router-view"),r=_("k-slot"),u=G("loading");return c(),p("div",{class:H({"is-left-aside-open":m(ne)})},[i(me),m(n)?(c(),v(o,{key:0},{default:k(({Component:d})=>[(c(),v(J,null,[(c(),v(Q(d)))],1024))]),_:1})):X((c(),p("div",ke,null,512)),[[u,!0]]),i(ve),i(r,{name:"global"})],2)}}}),ye={class:"k-card welcome"},Be=l("h1",null,"\u6B22\u8FCE\u4F7F\u7528 Koishi\uFF01",-1),Ce=l("p",null,"\u4F60\u7684\u673A\u5668\u4EBA\u5DF2\u7ECF\u51C6\u5907\u5C31\u7EEA\u3002\u70B9\u51FB\u4E0B\u9762\u7684\u4EFB\u4E00\u9009\u9879\uFF0C\u5F00\u542F\u4F60\u7684 Koishi \u4E4B\u65C5\u5427\u3002",-1),Ee=l("h2",null,"\u9605\u8BFB\u6587\u6863",-1),Fe=l("p",null,"\u5F00\u59CB\u9605\u8BFB\u5B98\u65B9\u6587\u6863\u3002\u5B98\u65B9\u6587\u6863\u91CC\u5305\u542B\u4E86\u4F60\u60F3\u8981\u4E86\u89E3\u7684\u5168\u90E8\u5185\u5BB9\u3002",-1),be=[Ee,Fe],we=y({__name:"welcome",setup(t){function e(){window.open("https://koishi.chat","_blank")}return(n,a)=>{const s=_("k-slot");return c(),p("div",ye,[Be,Ce,i(s,{name:"welcome-choice",class:"choices"},{default:k(()=>[l("div",{class:"choice",onClick:e},be)]),_:1})])}}});const xe=y({__name:"home",setup(t){return(e,n)=>{const a=_("k-slot"),s=_("el-scrollbar"),o=_("k-layout");return c(),v(o,{main:"darker",class:"page-home"},{default:k(()=>[i(s,null,{default:k(()=>[i(we),i(a,{name:"home"}),i(a,{name:"numeric",class:"card-grid profile-grid"}),i(a,{name:"chart",class:"card-grid chart-grid"})]),_:1})]),_:1})}}});const $e="modulepreload",Se=function(t){return"/"+t},V={},Le=function(e,n,a){if(!n||n.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(n.map(o=>{if(o=Se(o),o in V)return;V[o]=!0;const r=o.endsWith(".css"),u=r?'[rel="stylesheet"]':"";if(!!a)for(let B=s.length-1;B>=0;B--){const E=s[B];if(E.href===o&&(!r||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${u}`))return;const f=document.createElement("link");if(f.rel=r?"stylesheet":$e,r||(f.as="script",f.crossOrigin=""),f.href=o,document.head.appendChild(f),r)return new Promise((B,E)=>{f.addEventListener("load",B),f.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())},K=1;function Ae(t){const e=re("koishi-play",{});return e.value.version!==K?e.value={...t,version:K}:e.value={...t,...e.value},e}const h=Ae({current:null,instances:{}});let g;function j(){const t=Math.random().toString(36).slice(2,10);h.value.current=t,h.value.instances[t]={plugins:{console:{},help:{},sandbox:{},market:{}}},g&&R(t)}async function R(t){var n;await((n=g.app)==null?void 0:n.stop()),h.value.current=t,g.config=h.value.instances[t],await(await g.createApp()).start()}Object.keys(h.value.instances).length||j();async function De(){if(g)return g;const t=D.endpoint+"/modules/@koishijs/loader/index.js",{default:e}=await Le(()=>import(t),[]);return g=new e}const Oe=l("span",null,"\u5B9E\u4F8B\u7BA1\u7406",-1),Re={class:"name"},Ne={class:"actions"},Pe=y({__name:"index",setup(t){function e(n){delete h.value.instances[n]}return(n,a)=>{const s=_("k-button"),o=_("k-icon"),r=_("k-card");return c(),v(r,{class:"instances"},{header:k(()=>[Oe,i(s,{class:"right",onClick:m(j)},{default:k(()=>[L("\u6DFB\u52A0")]),_:1},8,["onClick"])]),default:k(()=>[l("table",null,[(c(!0),p(x,null,A(m(h).instances,(u,d)=>(c(),p("tr",{class:"instance",key:d},[l("td",Re,[L(w(u.name||d)+" ",1),m(h).current===d?(c(),p(x,{key:0},[L("(\u8FD0\u884C\u4E2D)")],64)):C("",!0)]),l("td",Ne,[l("span",null,[m(h).current!==d?(c(),v(o,{key:0,name:"start",onClick:f=>m(R)(d)},null,8,["onClick"])):C("",!0),m(h).current!==d?(c(),v(o,{key:1,name:"delete",onClick:f=>e(d)},null,8,["onClick"])):C("",!0)])])]))),128))])]),_:1})}}});class U{constructor(){F(this,"remote")}onopen(e){}onmessage(e){}onclose(e){}onerror(e){}send(e){this.remote.onmessage({data:e})}}class Ve extends U{constructor(n){super();F(this,"app");this.remote=n,this.start()}async start(){const n=await De();n[Symbol.for("koishi.socket")]=this,await R(h.value.current)}}class Ke extends U{constructor(){super();F(this,"remote",new Ve(this));this.onopen({}),O.slot({type:"home",order:900,component:Pe})}}const S=Y(ge);S.use(Z);S.provide("ecTheme","dark-blue");O.page({path:"/",name:"\u6B22\u8FCE",icon:"activity:home",order:1e3,component:xe});S.use($);$.afterEach(t=>{typeof t.name=="string"&&(document.title=`${t.name} | Koishi \u63A7\u5236\u53F0`)});S.mount("#app");if(D.static)N(new Ke);else{const t=new URL(D.endpoint,location.origin).toString();N(new WebSocket(t.replace(/^http/,"ws")))}

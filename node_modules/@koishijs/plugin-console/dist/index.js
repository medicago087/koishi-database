var q=Object.defineProperty;var z=(e,t,o)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var b=(e,t,o)=>(z(e,typeof t!="symbol"?t+"":t,o),o);import{reactive as G,defineComponent as g,computed as N,resolveComponent as l,openBlock as c,createBlock as p,withCtx as f,createElementVNode as v,toDisplayString as L,createElementBlock as d,createCommentVNode as w,unref as _,createVNode as m,withModifiers as H,renderSlot as J,Fragment as E,renderList as $,resolveDirective as Q,normalizeClass as X,KeepAlive as Y,resolveDynamicComponent as Z,withDirectives as ee,createTextVNode as x,createApp as te}from"./vue.js";import{useWindowSize as ne,useLocalStorage as oe,useDark as se}from"./vueuse.js";import ce,{router as A,activities as ie,store as re,isLeftAsideOpen as ae,socket as W,config as O,root as R,connect as V}from"./client.js";import{useRoute as ue}from"./vue-router.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=o(s);fetch(s.href,n)}})();const T=G({});A.afterEach(()=>{const{name:e,fullPath:t}=A.currentRoute.value;T[e]=t});const le={class:"title"},_e={key:0,class:"desc"},D=g({__name:"activity-item",props:{data:null,placement:null},setup(e){const t=e,o=N(()=>T[t.data.id]||t.data.path.replace(/:.+/,""));return(i,s)=>{const n=l("k-icon"),r=l("router-link"),a=l("el-tooltip");return c(),p(a,{placement:e.placement,"popper-class":"activity-item-tooltip"},{content:f(()=>[v("div",le,L(e.data.name),1),e.data.desc?(c(),d("div",_e,L(e.data.desc),1)):w("",!0)]),default:f(()=>[e.data.path?(c(),p(r,{key:0,class:"navbar-item",to:_(o)},{default:f(()=>[m(n,{class:"menu-icon",name:e.data.icon},null,8,["name"])]),_:1},8,["to"])):(c(),d("div",{key:1,class:"navbar-item",onClick:s[0]||(s[0]=H((...u)=>e.data.action&&e.data.action(...u),["stop"]))},[m(n,{class:"menu-icon",name:e.data.icon},null,8,["name"])]))]),_:1},8,["placement"])}}});const P=(e,t)=>{const o=e.__vccOpts||e;for(const[i,s]of t)o[i]=s;return o},de={},me={class:"navbar-item"};function pe(e,t){const o=l("k-icon"),i=l("el-tooltip");return c(),p(i,{placement:"right","popper-class":"activity-group-tooltip"},{content:f(()=>[J(e.$slots,"default")]),default:f(()=>[v("div",me,[m(o,{class:"menu-icon",name:"activity:ellipsis"})])]),_:3})}const fe=P(de,[["render",pe]]),he={class:"layout-activity"},ve={key:1,class:"spacer"},ke=g({__name:"activity-bar",setup(e){const{height:t}=ne(),o=N(()=>{let i;const s=Object.values(ie).filter(a=>a.position).sort((a,u)=>a.order-u.order);s.length*64>t.value&&(i=s.splice(0,s.length+1-Math.floor(t.value/64)).sort((a,u)=>{const h=a.position==="top"?-1:1;return a.position===u.position?h*(a.order-u.order):h}));const n=s.filter(a=>a.position==="top").reverse(),r=s.filter(a=>a.position==="bottom");return{top:n,bottom:r,hidden:i}});return(i,s)=>(c(),d("nav",he,[(c(!0),d(E,null,$(_(o).top,n=>(c(),p(D,{placement:"right",key:n.id,data:n},null,8,["data"]))),128)),_(o).hidden?(c(),p(fe,{key:0},{default:f(()=>[(c(!0),d(E,null,$(_(o).hidden,n=>(c(),p(D,{placement:"bottom",key:n.id,data:n},null,8,["data"]))),128))]),_:1})):(c(),d("div",ve)),(c(!0),d(E,null,$(_(o).bottom,n=>(c(),p(D,{placement:"right",key:n.id,data:n},null,8,["data"]))),128))]))}});const ye=P(ke,[["__scopeId","data-v-332b3fff"]]);const ge={},Be={class:"layout-status"};function Ee(e,t){const o=l("k-slot");return c(),d("footer",Be,[m(o,{name:"status-left"}),m(o,{name:"status-right"})])}const Fe=P(ge,[["render",Ee]]),be={key:1,class:"loading","element-loading-text":"\u6B63\u5728\u52A0\u8F7D\u6570\u636E\u2026\u2026"},Ce=g({__name:"index",setup(e){const t=ue(),o=N(()=>{var i;return(i=t.meta.activity)!=null&&i.fields?t.meta.activity.fields.every(s=>re[s]):!0});return(i,s)=>{const n=l("router-view"),r=l("k-slot"),a=Q("loading");return c(),d("div",{class:X({"is-left-aside-open":_(ae)})},[m(ye),_(o)?(c(),p(n,{key:0},{default:f(({Component:u})=>[(c(),p(Y,null,[(c(),p(Z(u)))],1024))]),_:1})):ee((c(),d("div",be,null,512)),[[a,!0]]),m(Fe),m(r,{name:"global"})],2)}}}),we={class:"k-card welcome"},$e=v("h1",null,"\u6B22\u8FCE\u4F7F\u7528 Koishi\uFF01",-1),xe=v("p",null,"\u4F60\u7684\u673A\u5668\u4EBA\u5DF2\u7ECF\u51C6\u5907\u5C31\u7EEA\u3002\u70B9\u51FB\u4E0B\u9762\u7684\u4EFB\u4E00\u9009\u9879\uFF0C\u5F00\u542F\u4F60\u7684 Koishi \u4E4B\u65C5\u5427\u3002",-1),Ae=v("h2",null,"\u9605\u8BFB\u6587\u6863",-1),Se=v("p",null,"\u5F00\u59CB\u9605\u8BFB\u5B98\u65B9\u6587\u6863\u3002\u5B98\u65B9\u6587\u6863\u91CC\u5305\u542B\u4E86\u4F60\u60F3\u8981\u4E86\u89E3\u7684\u5168\u90E8\u5185\u5BB9\u3002",-1),De=[Ae,Se],Le=g({__name:"welcome",setup(e){function t(){window.open("https://koishi.chat","_blank")}return(o,i)=>{const s=l("k-slot");return c(),d("div",we,[$e,xe,m(s,{name:"welcome-choice",class:"choices"},{default:f(()=>[v("div",{class:"choice",onClick:t},De)]),_:1})])}}});const Oe={key:1},Ne=g({__name:"home",setup(e){return(t,o)=>{const i=l("k-slot"),s=l("el-scrollbar"),n=l("k-card"),r=l("k-layout");return c(),p(r,{main:`darker page-home${_(W)?"":" loading"}`},{default:f(()=>[_(W)?(c(),p(s,{key:0},{default:f(()=>[m(Le),m(i,{name:"home"}),m(i,{name:"numeric",class:"card-grid profile-grid"}),m(i,{name:"chart",class:"card-grid chart-grid"})]),_:1})):(c(),d("div",Oe,[m(n,{class:"connect"},{default:f(()=>[x("\u6B63\u5728\u8FDE\u63A5\u5230 Koishi \u670D\u52A1\u5668\u2026\u2026")]),_:1})]))]),_:1},8,["main"])}}});const Re="modulepreload",Pe=function(e){return"/"+e},j={},Ke=function(t,o,i){if(!o||o.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(o.map(n=>{if(n=Pe(n),n in j)return;j[n]=!0;const r=n.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(!!i)for(let B=s.length-1;B>=0;B--){const F=s[B];if(F.href===n&&(!r||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const h=document.createElement("link");if(h.rel=r?"stylesheet":Re,r||(h.as="script",h.crossOrigin=""),h.href=n,document.head.appendChild(h),r)return new Promise((B,F)=>{h.addEventListener("load",B),h.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())},I=1;function We(e){const t=oe("koishi-play",{});return t.value.version!==I?t.value={...e,version:I}:t.value={...e,...t.value},t}const k=We({current:null,instances:{}});let y;function M(){const e=Math.random().toString(36).slice(2,10);k.value.current=e,k.value.instances[e]={plugins:{console:{},help:{},sandbox:{},market:{}}},y&&K(e)}async function K(e){var o;await((o=y.app)==null?void 0:o.stop()),k.value.current=e,y.config=k.value.instances[e],await(await y.createApp()).start()}Object.keys(k.value.instances).length||M();async function Ve(){if(y)return y;const e=O.endpoint+"/modules/@koishijs/loader/index.js",{default:t}=await Ke(()=>import(e),[]);return y=new t}const je=v("span",null,"\u5B9E\u4F8B\u7BA1\u7406",-1),Ie={class:"name"},Te={class:"actions"},Me=g({__name:"index",setup(e){function t(o){delete k.value.instances[o]}return(o,i)=>{const s=l("k-button"),n=l("k-icon"),r=l("k-card");return c(),p(r,{class:"instances"},{header:f(()=>[je,m(s,{class:"right",onClick:_(M)},{default:f(()=>[x("\u6DFB\u52A0")]),_:1},8,["onClick"])]),default:f(()=>[v("table",null,[(c(!0),d(E,null,$(_(k).instances,(a,u)=>(c(),d("tr",{class:"instance",key:u},[v("td",Ie,[x(L(a.name||u)+" ",1),_(k).current===u?(c(),d(E,{key:0},[x("(\u8FD0\u884C\u4E2D)")],64)):w("",!0)]),v("td",Te,[v("span",null,[_(k).current!==u?(c(),p(n,{key:0,name:"start",onClick:h=>_(K)(u)},null,8,["onClick"])):w("",!0),_(k).current!==u?(c(),p(n,{key:1,name:"delete",onClick:h=>t(u)},null,8,["onClick"])):w("",!0)])])]))),128))])]),_:1})}}});class U{constructor(){b(this,"remote")}onopen(t){}onmessage(t){}onclose(t){}onerror(t){}send(t){this.remote.onmessage({data:t})}}class Ue extends U{constructor(o){super();b(this,"app");this.remote=o,this.start()}async start(){const o=await Ve();o[Symbol.for("koishi.socket")]=this,await K(k.value.current)}}class qe extends U{constructor(){super();b(this,"remote",new Ue(this));this.onopen({}),R.slot({type:"home",order:900,component:Me})}}const S=te(Ce);S.use(ce);S.provide("ecTheme","dark-blue");R.page({path:"/",name:"\u6B22\u8FCE",icon:"activity:home",order:1e3,component:Ne});const C=se();R.page({id:"dark-mode",position:"bottom",order:-100,name:()=>C.value?"\u6697\u9ED1\u6A21\u5F0F":"\u660E\u4EAE\u6A21\u5F0F",icon:()=>"activity:"+(C.value?"moon":"sun"),action:()=>C.value=!C.value});S.use(A);A.afterEach(e=>{e.meta.activity&&(document.title=`${e.meta.activity.name} | Koishi \u63A7\u5236\u53F0`)});S.mount("#app");if(O.static)V(()=>new qe);else{const e=new URL(O.endpoint,location.origin).toString();V(()=>new WebSocket(e.replace(/^http/,"ws")))}

import { computed as x, defineComponent as E, openBlock as l, createElementBlock as p, createElementVNode as o, toDisplayString as m, createVNode as i, unref as s, ref as H, watch as b, resolveComponent as d, createBlock as g, withCtx as _, Fragment as F, renderList as I, normalizeClass as N, KeepAlive as K } from "../vue.js";
import { createStorage as W, receive as $, MessageContent as q, Schema as B, store as A, clone as G, deepEqual as J, send as k, VirtualList as P, ChatInput as Q, message as R, icons as X } from "../client.js";
const Y = {
  private: "\u79C1\u804A\u6A21\u5F0F",
  guild: "\u7FA4\u804A\u6A21\u5F0F",
  profile: "\u7528\u6237\u8BBE\u7F6E"
}, t = W("sandbox", 1, () => ({
  user: "",
  index: 0,
  messages: {},
  panelType: "private"
})), y = x(() => t.panelType === "guild" ? "#" : "@" + t.user);
$("sandbox", (n) => {
  var r, a;
  ((r = t.messages)[a = n.channel] || (r[a] = [])).push(n);
});
$("sandbox/clear", () => {
  t.messages[y.value] = [];
});
const Z = [
  "Alice",
  "Bob",
  "Carol",
  "Dave",
  "Eve",
  "Frank",
  "Grace",
  "Hank",
  "Ivy",
  "Jack",
  "Kathy",
  "Lily",
  "Mandy",
  "Nancy",
  "Oscar",
  "Peggy",
  "Quinn",
  "Randy",
  "Sandy",
  "Toby",
  "Uma",
  "Vicky",
  "Wendy",
  "Xander",
  "Yvonne",
  "Zoe"
], ee = { class: "chat-message" }, te = { class: "avatar" }, se = { class: "nickname" }, ne = { class: "message-box" }, ae = /* @__PURE__ */ E({
  __name: "message",
  props: {
    data: null
  },
  setup(n) {
    return (r, a) => (l(), p("div", ee, [
      o("div", te, m(n.data.user[0]), 1),
      o("div", se, m(n.data.user), 1),
      o("div", ne, [
        i(s(q), {
          content: n.data.content
        }, null, 8, ["content"])
      ])
    ]));
  }
});
const w = (n, r) => {
  const a = n.__vccOpts || n;
  for (const [C, v] of r)
    a[C] = v;
  return a;
}, oe = /* @__PURE__ */ w(ae, [["__scopeId", "data-v-cc500173"]]), ue = { class: "user-container" }, ce = { class: "avatar" }, le = { class: "nick" }, re = ["onClick"], ie = { class: "card-header" }, de = ["onClick"], _e = /* @__PURE__ */ o("div", null, "\u70B9\u51FB\u300C\u6DFB\u52A0\u7528\u6237\u300D\u5F00\u59CB\u4F53\u9A8C", -1), pe = { class: "card-footer" }, me = /* @__PURE__ */ E({
  __name: "index",
  setup(n) {
    const r = B.object({
      authority: B.natural().description("\u6743\u9650\u7B49\u7EA7").default(1)
    }), a = x(() => Object.keys(t.messages).filter((e) => e.startsWith("@")).map((e) => e.slice(1))), C = x(() => Object.fromEntries(a.value.map((e) => [e, { name: e }]))), v = 10;
    function V() {
      if (a.value.length >= v)
        return R.error("\u53EF\u521B\u5EFA\u7684\u7528\u6237\u6570\u91CF\u5DF2\u8FBE\u4E0A\u9650\u3002");
      let e;
      do
        e = Z[t.index++], t.index %= v;
      while (a.value.includes(e));
      t.user = e, t.messages["@" + e] = [], k("sandbox/user", t.user, {});
    }
    function L(e) {
      const c = a.value.indexOf(e);
      delete t.messages["@" + e], k("sandbox/user", t.user, null), t.user === e && (t.user = a.value[c] || "");
    }
    const h = H();
    b(() => {
      var e;
      return (e = A.users) == null ? void 0 : e[t.user];
    }, (e) => {
      h.value = G(e);
    }, { immediate: !0 }), b(h, (e) => {
      var c;
      J(e, (c = A.users) == null ? void 0 : c[t.user]) || k("sandbox/user", t.user, e);
    }, { deep: !0 });
    function S(e) {
      k("sandbox/message", t.user, y.value, e);
    }
    return (e, c) => {
      const M = d("k-icon"), D = d("k-tab-group"), T = d("el-scrollbar"), z = d("k-empty"), O = d("k-form"), U = d("k-content"), j = d("k-layout");
      return l(), g(j, { class: "page-sandbox" }, {
        left: _(() => [
          o("div", {
            class: "card-header k-menu-item",
            onClick: V
          }, "\u6DFB\u52A0\u7528\u6237"),
          o("div", ue, [
            i(T, null, {
              default: _(() => [
                i(D, {
                  data: s(C),
                  modelValue: s(t).user,
                  "onUpdate:modelValue": c[0] || (c[0] = (u) => s(t).user = u)
                }, {
                  default: _(({ name: u }) => [
                    o("div", ce, m(u[0]), 1),
                    o("div", le, m(u), 1),
                    o("div", {
                      class: "close",
                      onClick: (f) => L(u)
                    }, [
                      i(M, { name: "times-full" })
                    ], 8, re)
                  ]),
                  _: 1
                }, 8, ["data", "modelValue"])
              ]),
              _: 1
            })
          ])
        ]),
        default: _(() => [
          o("div", ie, [
            (l(!0), p(F, null, I(s(Y), (u, f) => (l(), p("span", {
              key: f,
              class: N(["k-horizontal-tab-item", { active: s(t).panelType === f }]),
              onClick: (Ce) => s(t).panelType = f
            }, m(u), 11, de))), 128))
          ]),
          (l(), g(K, null, [
            s(a).length ? s(t).panelType === "profile" ? (l(), g(U, {
              key: "profile" + s(y)
            }, {
              default: _(() => [
                i(O, {
                  instant: "",
                  modelValue: h.value,
                  "onUpdate:modelValue": c[1] || (c[1] = (u) => h.value = u),
                  schema: s(r),
                  "show-header": !1
                }, null, 8, ["modelValue", "schema"])
              ]),
              _: 1
            })) : (l(), p(F, { key: 2 }, [
              i(s(P), {
                data: s(t).messages[s(y)] || [],
                pinned: ""
              }, {
                default: _((u) => [
                  i(oe, { data: u }, null, 8, ["data"])
                ]),
                _: 1
              }, 8, ["data"]),
              o("div", pe, [
                i(s(Q), { onSend: S })
              ])
            ], 64)) : (l(), g(z, { key: "empty" }, {
              default: _(() => [
                _e
              ]),
              _: 1
            }))
          ], 1024))
        ]),
        _: 1
      });
    };
  }
});
const ve = {}, he = {
  class: "k-icon",
  xmlns: "http://www.w3.org/2000/svg",
  viewBox: "0 0 448 512"
}, fe = /* @__PURE__ */ o("path", {
  fill: "currentColor",
  d: "M437.2 403.5L319.1 215l.0001-135C319.1 71.16 312.8 64 303.1 64S288 71.16 288 79.1L287.1 215c0 5.973 1.672 11.83 4.826 16.9L347.6 320H100.4l54.79-88.1C158.3 226.8 160 220.1 160 215L160 79.1C160 71.16 152.8 64 144 64S128 71.16 128 79.1L128 215l-117.2 188.5C-18.48 450.6 15.27 512 70.89 512h306.2C432.7 512 466.5 450.5 437.2 403.5zM410.9 460C407.6 466 397.6 480 377.1 480H70.89c-20.51 0-30.48-13.95-33.82-19.95c-7.025-12.63-6.691-27.46 .873-39.65L80.48 352h287l42.55 68.41C417.6 432.6 417.1 447.4 410.9 460zM112 32h224C344.8 32 352 24.84 352 16S344.8 0 336 0h-224C103.2 0 96 7.156 96 16S103.2 32 112 32z"
}, null, -1), ge = [
  fe
];
function ke(n, r) {
  return l(), p("svg", he, ge);
}
const ye = /* @__PURE__ */ w(ve, [["render", ke]]);
X.register("activity:flask", ye);
const Fe = (n) => {
  n.page({
    name: "\u6C99\u76D2",
    path: "/sandbox",
    icon: "activity:flask",
    order: 300,
    authority: 4,
    component: me
  });
};
export {
  Fe as default
};
